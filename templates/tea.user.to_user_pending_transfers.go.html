{{ define "content" }}

<ol class="breadcrumb">
  <li><a href="/v1/">大堂</a></li>
   <li>{{ .SessUser.Name }} 的星茶罐</li>
  <li><a href="/v1/tea/user/account/page">管理个人星茶账户</a></li>
  <li class="active">等待对方接收的转账</li>
</ol>

<div class="container">

    <div class="row">
        <!-- 个人星茶账户概览 -->
        <div class="col-md-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        <span class="glyphicon glyphicon-leaf" aria-hidden="true"></span>
                        星茶罐
                        <span class="pull-right">
                            状态: <span class="label {{ if eq .TeaAccount.Status "frozen" }}label-danger{{ else }}label-success{{ end }}">{{ .StatusDisplay }}</span>
                        </span>
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h4>总余额（毫克）: <strong>{{ .BalanceDisplay }}</strong></h4>
                            <p class="text-muted">您的星茶资产总量</p>
                        </div>
                        <div class="col-md-4">
                            <h4>锁定余额（毫克）: <strong>{{ .LockedBalanceDisplay }}</strong></h4>
                            <p class="text-muted">待确认转账中锁定的星茶</p>
                        </div>
                        <div class="col-md-4">
                            <h4>可用余额（毫克）: <strong>{{ .AvailableBalanceDisplay }}</strong></h4>
                            <p class="text-muted">可以立即使用的星茶</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!-- 操作按钮 -->
    <div class="row" style="margin-bottom: 2rem ;">
        <div class="col-md-12">
           
            <div class="btn-group">
                <a href="/v1/tea/user/account/page" class="btn btn-default">
                    <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>
                    返回星茶罐
                </a>
                <a href="/v1/tea/user/transfers/pending/page" class="btn btn-warning">
                    <span class="glyphicon glyphicon-time" aria-hidden="true"></span>
                    待确认转账
                </a>
            </div>
           
        </div>
    </div>
    <div class="row">
        <!-- 待确认转账列表 -->
        <div class="col-md-12">
            <div class="panel panel-warning">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        <span class="glyphicon glyphicon-send" aria-hidden="true"></span>
                        等待对方接收的转账
                        {{ if .Transfers }}
                        <span class="badge">{{ len .Transfers }}</span>
                        {{ end }}
                    </h3>
                </div>
                <div class="panel-body">
                    {{ if .Transfers }}
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>接收方</th>
                                    <th>数额(毫克)</th>
                                    <th>转账说明</th>
                                    <th>剩余时间</th>
                                    <th>状态</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{ range .Transfers }}
                                <tr class="{{ if .IsExpired }}danger{{ end }}">
                                    <td>
                                        <a href="/v1/user/biography?uuid={{ .ToUserId }}" class="btn-link">
                                            <strong>{{ .ToUserName }}</strong>
                                        </a>
                                        <br>
                                        <small class="text-muted">用户ID: {{ .ToUserId }}</small>
                                    </td>
                                    <td>
                                        <strong class="text-success">{{ .AmountDisplay }}</strong>
                                    </td>
                                    <td>
                                        {{ if .Notes }}
                                        <span>{{ .Notes }}</span>
                                        {{ else }}
                                        <span class="text-muted">无备注</span>
                                        {{ end }}
                                    </td>
                                    <td>
                                        {{ if .IsExpired }}
                                        <span class="text-danger">
                                            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                                            已过期
                                        </span>
                                        {{ else }}
                                        <span class="text-warning">
                                            <span class="glyphicon glyphicon-time" aria-hidden="true"></span>
                                            {{ .TimeRemaining }}
                                        </span>
                                        {{ end }}
                                    </td>
                                    <td>
                                        {{ if .IsExpired }}
                                        <span class="label label-danger">已过期</span>
                                        {{ else }}
                                        <span class="label label-warning">等待对方接收</span>
                                        {{ end }}
                                    </td>
                                </tr>
                                {{ end }}
                            </tbody>
                        </table>
                    </div>
                    {{ else }}
                    <div class="text-center" style="padding: 40px;">
                        <span class="glyphicon glyphicon-send" style="font-size: 48px; color: #ccc;" aria-hidden="true"></span>
                        <h3 class="text-muted">暂无进行中转账</h3>
                        <p class="text-muted">您向其他茶友发起的转账将在对方接收前显示在这里</p>
                        <a href="/v1/tea/user/transfer/to_user/page" class="btn btn-primary" style="margin-top: 15px;">
                            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                            发起转账
                        </a>
                    </div>
                    {{ end }}
                </div>
                {{ if .Transfers }}
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-md-6">
                            <p class="text-muted">
                                <small>
                                    <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>
                                    转账过期后将自动失效，锁定的星茶将退回您的账户
                                </small>
                            </p>
                        </div>
                        <div class="col-md-6 text-right">
                            <button type="button" class="btn btn-primary" onclick="refreshPage()">
                                <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span>
                                刷新列表
                            </button>
                        </div>
                    </div>
                </div>
                {{ end }}
            </div>
        </div>
    </div>

    <!-- 使用说明 -->
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
                        使用说明
                    </h4>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5><span class="glyphicon glyphicon-send" aria-hidden="true"></span> 转账发起</h5>
                            <p>您发起的转账正在等待对方接收，转账数额已从您的账户中锁定。</p>
                        </div>
                        <div class="col-md-6">
                            <h5><span class="glyphicon glyphicon-ok-circle" aria-hidden="true"></span> 接收确认</h5>
                            <p>对方接受转账后，星茶将转入对方账户；若对方拒绝，星茶将退回您的账户。</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <h5><span class="glyphicon glyphicon-time" aria-hidden="true"></span> 有效期限</h5>
                            <p>每个转账都有有效期限制，过期后转账将自动失效，锁定的星茶将退回。</p>
                        </div>
                        <div class="col-md-6">
                            <h5><span class="glyphicon glyphicon-lock" aria-hidden="true"></span> 锁定说明</h5>
                            <p>转账发起后，相应金额将被锁定，在对方确认或转账过期前无法使用。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
// 刷新页面
function refreshPage() {
    location.reload();
}

// 页面加载完成后自动刷新（每5分钟）
$(document).ready(function() {
    // 如果有待确认转账，每5分钟自动刷新一次
    {{ if .Transfers }}
    setInterval(function() {
        location.reload();
    }, 5 * 60 * 1000); // 5分钟
    {{ end }}
});
</script>

{{ end }}