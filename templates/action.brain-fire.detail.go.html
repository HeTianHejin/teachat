{{ define "content" }}

<ol class="breadcrumb">
  <li><a href="/v1/">大堂</a></li>
  <li><a href="/v1/objective/detail?uuid={{ .QuoteObjectiveBean.Objective.Uuid }}">{{ .QuoteObjectiveBean.Objective.Title }}@茶围</a></li>
  <li><a href="/v1/project/detail?uuid={{ .ProjectBean.Project.Uuid }}">{{ .ProjectBean.Project.Title }}@茶台</a></li>
  <li class="active">"脑火"记录详情</li>
  <li>
    {{ template "component_sess_capacity" . }}
  </li>
</ol>

{{ template "component_project_simple_detail" . }}

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">
      <i class="bi-fire" style="font-size: 1.5rem; color: red;"></i>
      "脑火"记录 #{{ .BrainFireBean.BrainFire.Id }} - {{ .BrainFireBean.BrainFire.Title }}
      <span class="label label-{{ if eq .BrainFireBean.BrainFire.Status 4 }}success{{ else if eq .BrainFireBean.BrainFire.Status 3 }}warning{{ else if eq .BrainFireBean.BrainFire.Status 2 }}info{{ else }}default{{ end }} pull-right">
        {{ .BrainFireBean.BrainFire.StatusString }}
      </span>
    </h3>
  </div>

  <div class="panel-body">
    <!-- 基本信息 -->
    <div class="row">
      <div class="col-md-6">
        <h4>基本信息</h4>
        <table class="table table-bordered">
          <tr>
            <td><strong>记录ID</strong></td>
            <td>{{ .BrainFireBean.BrainFire.Id }}</td>
          </tr>
          <tr>
            <td><strong>脑火标题</strong></td>
            <td>{{ .BrainFireBean.BrainFire.Title }}</td>
          </tr>
          <tr>
            <td><strong>当前状态</strong></td>
            <td>
              <span class="label label-{{ if eq .BrainFireBean.BrainFire.Status 4 }}success{{ else if eq .BrainFireBean.BrainFire.Status 3 }}warning{{ else if eq .BrainFireBean.BrainFire.Status 2 }}info{{ else }}default{{ end }}">
                {{ .BrainFireBean.BrainFire.StatusString }}
              </span>
            </td>
          </tr>
          <tr>
            <td><strong>脑火类别</strong></td>
            <td>
              <span class="label label-{{ if eq .BrainFireBean.BrainFire.BrainFireClass 1 }}primary{{ else }}success{{ end }}">
                {{ if eq .BrainFireBean.BrainFire.BrainFireClass 1 }}文艺类{{ else }}理工类{{ end }}
              </span>
            </td>
          </tr>
          <tr>
            <td><strong>公开性</strong></td>
            <td>
              <span class="label label-{{ if eq .BrainFireBean.BrainFire.BrainFireType 1 }}info{{ else }}warning{{ end }}">
                {{ if eq .BrainFireBean.BrainFire.BrainFireType 1 }}公开{{ else }}私密{{ end }}
              </span>
            </td>
          </tr>
          <tr>
            <td><strong>创建时间</strong></td>
            <td>{{ .BrainFireBean.BrainFire.CreatedDateTime }}</td>
          </tr>
          <tr>
            <td><strong>开始时间</strong></td>
            <td>{{ .BrainFireBean.BrainFire.StartTime.Format "2006-01-02 15:04:05" }}</td>
          </tr>
          <tr>
            <td><strong>结束时间</strong></td>
            <td>{{ .BrainFireBean.BrainFire.EndTime.Format "2006-01-02 15:04:05" }}</td>
          </tr>
        </table>
      </div>
      
      <div class="col-md-6">
        <h4>创建者信息</h4>
        <div class="panel panel-info">
          <div class="panel-body">
            <p><strong>创建者ID：</strong>{{ .BrainFireBean.BrainFire.VerifierUserId }}</p>
            <p><strong>创建时间：</strong>{{ .BrainFireBean.BrainFire.CreatedDateTime }}</p>
            {{ if .BrainFireBean.Environment.Id }}
            <p><strong>环境条件：</strong>{{ .BrainFireBean.Environment.Name }}</p>
            {{ end }}
          </div>
        </div>
      </div>
    </div>



    <!-- 思考内容 -->
    <div class="row">
      <div class="col-md-12">
        <h4><span class="glyphicon glyphicon-flash"></span> 思考过程</h4>
        
        <div class="panel panel-primary">
          <div class="panel-heading"><strong>1. 快速推理</strong></div>
          <div class="panel-body">
            <p style="white-space: pre-wrap;">{{ .BrainFireBean.BrainFire.Inference }}</p>
          </div>
        </div>

        <div class="panel panel-info">
          <div class="panel-heading"><strong>2. 诊断验证</strong></div>
          <div class="panel-body">
            <p style="white-space: pre-wrap;">{{ .BrainFireBean.BrainFire.Diagnose }}</p>
          </div>
        </div>

        <div class="panel panel-success">
          <div class="panel-heading"><strong>3. 最终解决方案</strong></div>
          <div class="panel-body">
            <p style="white-space: pre-wrap;">{{ .BrainFireBean.BrainFire.Judgement }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- 时间统计 -->
    <div class="row">
      <div class="col-md-12">
        <h4><span class="glyphicon glyphicon-time"></span> 时间统计</h4>
        <div class="panel panel-default">
          <div class="panel-body">
            <div class="row">
              <div class="col-md-4 text-center">
                <h5>总用时</h5>
                <span class="label label-primary" style="font-size: 1.2em;">
                  {{ $duration := .BrainFireBean.BrainFire.EndTime.Sub .BrainFireBean.BrainFire.StartTime }}
                  {{ $minutes := $duration.Minutes }}
                  {{ if lt $minutes 60.0 }}
                    {{ printf "%.0f分钟" $minutes }}
                  {{ else }}
                    {{ printf "%.1f小时" $duration.Hours }}
                  {{ end }}
                </span>
              </div>
              <div class="col-md-4 text-center">
                <h5>开始时间</h5>
                <p>{{ .BrainFireBean.BrainFire.StartTime.Format "15:04:05" }}</p>
              </div>
              <div class="col-md-4 text-center">
                <h5>结束时间</h5>
                <p>{{ .BrainFireBean.BrainFire.EndTime.Format "15:04:05" }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 操作按钮 -->
    <div class="text-center" style="margin-top: 20px;">
      <a href="/v1/project/detail?uuid={{ .ProjectBean.Project.Uuid }}" class="btn btn-default">
        <span class="glyphicon glyphicon-arrow-left"></span> 返回项目
      </a>
      {{ if and .IsVerifier (eq .BrainFireBean.BrainFire.Status 2) }}
      <button class="btn btn-warning" onclick="updateBrainFireStatus(3)">
        <span class="glyphicon glyphicon-fire"></span> 点燃脑火
      </button>
      {{ else if and .IsVerifier (eq .BrainFireBean.BrainFire.Status 3) }}
      <button class="btn btn-success" onclick="updateBrainFireStatus(4)">
        <span class="glyphicon glyphicon-ok"></span> 熄灭脑火
      </button>
      {{ end }}
    </div>
  </div>

  <div class="panel-footer">
    <i class="bi-lightbulb" style="font-size: 2rem; color: orange;"></i>
    茶博士："脑火"记录展示了限时思考的完整过程，从快速推理到最终解决方案，体现了智力资源的运用过程。
  </div>
</div>

<script>
function updateBrainFireStatus(status) {
  if (confirm('确定要更新脑火状态吗？')) {
    fetch('/v1/brain-fire/update-status', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: 'uuid={{ .BrainFireBean.BrainFire.Uuid }}&status=' + status
    }).then(response => {
      if (response.ok) {
        location.reload();
      } else {
        alert('更新失败，请重试');
      }
    });
  }
}
</script>

{{ end }}