{{ define "content" }}

<ol class="breadcrumb">
  <li><a href="/v1/">大堂</a></li>
  <li><a href="/v1/tea/user/account/page">{{ .SessUser.Name }} 的茶叶罐</a></li>
  <li class="active">交易历史</li>
</ol>

<div class="container">

    <div class="row">
        <!-- 个人茶叶账户概览 -->
        <div class="col-md-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        <span class="glyphicon glyphicon-leaf" aria-hidden="true"></span>
                        个人茶叶账户
                        <span class="pull-right">
                            状态: <span class="label {{ if eq .TeaAccount.Status "frozen" }}label-danger{{ else }}label-success{{ end }}">{{ .StatusDisplay }}</span>
                        </span>
                    </h3>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h4>当前余额: <strong>{{ .BalanceDisplay }}</strong></h4>
                            <p class="text-muted">您的茶叶资产总量</p>
                            <p>锁定余额: {{ .LockedBalanceDisplay }}</p>
                            <p>可用余额: {{ .AvailableBalanceDisplay }}</p>
                        </div>
                        <div class="col-md-6">
                            <div class="btn-group-vertical" role="group" style="width: 100%;">
                                <a href="/v1/tea/user/account/page" class="btn btn-default">
                                    <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>
                                    返回茶叶罐
                                </a>
                                <a href="/v1/tea/user/transfers/history/page" class="btn btn-default">
                                    <span class="glyphicon glyphicon-exchange" aria-hidden="true"></span>
                                    转账记录
                                </a>
                                <a href="/v1/tea/user/transfers/pending/page" class="btn btn-warning">
                                    <span class="glyphicon glyphicon-time" aria-hidden="true"></span>
                                    待确认转账
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 交易历史列表 -->
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
                        交易历史
                        <small class="pull-right">基于转出表和转入表的交易记录</small>
                    </h3>
                </div>
                <div class="panel-body">
                    {{ if .Transactions }}
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>时间</th>
                                    <th>类型</th>
                                    <th>数量</th>
                                    <th>状态</th>
                                    <th>发送方</th>
                                    <th>接收方</th>
                                    <th>备注</th>
                                    <th>支付时间</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{ range .Transactions }}
                                <tr class="{{ if .IsIncome }}success{{ else }}danger{{ end }}">
                                    <td>{{ .CreatedAt.Format "01-02 15:04" }}</td>
                                    <td>
                                        <span class="label {{ if .IsIncome }}label-success{{ else }}label-danger{{ end }}">
                                            {{ .TypeDisplay }}
                                        </span>
                                    </td>
                                    <td>
                                        <strong>{{ .AmountDisplay }}</strong>
                                    </td>
                                    <td>
                                        <span class="label {{ if eq .Status "completed" }}label-success{{ else }}label-warning{{ end }}">
                                            {{ if eq .Status "completed" }}已完成
                                            {{ else if eq .Status "pending_receipt" }}待确认
                                            {{ else if eq .Status "rejected" }}已拒绝
                                            {{ else if eq .Status "expired" }}已过期
                                            {{ else }}{{ .Status }}
                                            {{ end }}
                                        </span>
                                    </td>
                                    <td>
                                        {{ if .FromUserName }}
                                        <div class="text-primary">
                                            <a href="/v1/user/biography?uuid={{ .FromUserId }}">{{ .FromUserName }}</a>
                                            <br><small class="text-muted">ID: {{ .FromUserId }}</small>
                                        </div>
                                        {{ else }}
                                        <span class="text-muted">用户 ID: {{ .FromUserId }}</span>
                                        {{ end }}
                                    </td>
                                    <td>
                                        {{ if .ToUserName }}
                                        <div class="text-success">
                                            <a href="/v1/user/biography?uuid={{ .ToUserId }}">{{ .ToUserName }}</a>
                                            <br><small class="text-muted">ID: {{ .ToUserId }}</small>
                                        </div>
                                        {{ else if gt .ToTeamId 0 }}
                                        <div>
                                            <span class="label label-info">团队</span>
                                            <br><small class="text-muted">团队 ID: {{ .ToTeamId }}</small>
                                        </div>
                                        {{ else }}
                                        <span class="text-muted">用户 ID: {{ .ToUserId }}</span>
                                        {{ end }}
                                    </td>
                                    <td>
                                        <small class="text-muted">{{ .Notes }}</small>
                                    </td>
                                    <td>
                                        {{ if .PaymentTime }}
                                        {{ .PaymentTime.Format "01-02 15:04" }}
                                        {{ else }}
                                        <span class="text-muted">-</span>
                                        {{ end }}
                                    </td>
                                </tr>
                                {{ end }}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- 分页 -->
                    <nav aria-label="交易记录分页">
                        <ul class="pagination pagination-sm">
                            {{ if gt .CurrentPage 1 }}
                            <li>
                                <a href="/v1/tea/user/transactions/history/page?page={{ sub .CurrentPage 1 }}" aria-label="上一页">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            {{ end }}
                            
                            <li class="active">
                                <span>第 {{ .CurrentPage }} 页</span>
                            </li>
                            
                            <li>
                                <a href="/v1/tea/user/transactions/history/page?page={{ add .CurrentPage 1 }}" aria-label="下一页">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                    
                    {{ else }}
                    <div class="alert alert-info">
                        <h4><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> 暂无交易记录</h4>
                        <p>您还没有任何交易记录。开始一些交易活动，这里就会显示您的交易历史了。</p>
                        <p>
                            <a href="/v1/tea/user/account/page" class="btn btn-primary">
                                <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>
                                返回茶叶罐
                            </a>
                        </p>
                    </div>
                    {{ end }}
                </div>
            </div>
        </div>
    </div>

</div>

{{ end }}